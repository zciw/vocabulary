-- Create Get Last Transaction Permissions
DECLARE @securableTypeID int;
DECLARE @getlastTransactionSecurableID int;

SELECT @securableTypeID = Id FROM dict.SecurableType WHERE Name = 'Payment Terminal Management';
SET @getlastTransactionSecurableID = 1000002;

IF NOT EXISTS (SELECT 1 FROM auth.PermissionSetSecurable WHERE [SecurableId] = @getlastTransactionSecurableID)
BEGIN
	INSERT INTO [auth].[PermissionSetSecurable] VALUES ( 1,@securableTypeID,20,@getlastTransactionSecurableID),     -- first const parameter PermisionSetid 1=All allowed ([auth].[PermissionSet]), Third const parameter PermissionId 20 = Granted ([auth].[Permission])
													   ( 5,@securableTypeID,20,@getlastTransactionSecurableID),     -- first const parameter PermisionSetid 1=All allowed ([auth].[PermissionSet]), Third const parameter PermissionId 20 = Granted ([auth].[Permission])
													   ( 169,@securableTypeID,19,@getlastTransactionSecurableID),   -- first const parameter PermisionSetid 169=POS All allowed ([auth].[PermissionSet]), Third const parameter PermissionId 19 = Approving ([auth].[Permission])
													   ( 169,@securableTypeID,20,@getlastTransactionSecurableID)    -- first const parameter PermisionSetid 169=POS All allowed ([auth].[PermissionSet]), Third const parameter PermissionId 20 = Granted ([auth].[Permission])
END

IF NOT EXISTS (SELECT 1 FROM dbo.ApplicationFunction WHERE [Id] = @getlastTransactionSecurableID)
BEGIN
	INSERT INTO [dbo].[ApplicationFunction] VALUES ( @getlastTransactionSecurableID,N'Get last transaction',N'Button Payment Terminal Get Last Transaction',@securableTypeID, '[20]') -- last parameter equal to added permissions 20 = Granted
END
ELSE
BEGIN
	UPDATE [dbo].[ApplicationFunction]
	SET [Name] = N'Get last transaction'
		,[Description] = N'Button Payment Terminal Get Last Transaction'
		,[SecurableTypeId] = @securableTypeID
		,[permissionFilter] = '[20]'
	WHERE Id = @getlastTransactionSecurableID
END

-- END Get Last Transaction Permissions

-- Create Global Reconciliation Permissions
DECLARE @globalReconciliationSecurableId int;
SET @globalReconciliationSecurableId = 1000001;

IF NOT EXISTS (SELECT 1 FROM auth.PermissionSetSecurable WHERE [SecurableId] = @globalReconciliationSecurableId)
BEGIN
	INSERT INTO [auth].[PermissionSetSecurable] VALUES ( 1,@securableTypeID,20,@globalReconciliationSecurableId),     -- first const parameter PermisionSetid 1=All allowed ([auth].[PermissionSet]), Third const parameter PermissionId 20 = Granted ([auth].[Permission])
													   ( 5,@securableTypeID,20,@globalReconciliationSecurableId),     -- first const parameter PermisionSetid 1=All allowed ([auth].[PermissionSet]), Third const parameter PermissionId 20 = Granted ([auth].[Permission])
													   ( 169,@securableTypeID,19,@globalReconciliationSecurableId),   -- first const parameter PermisionSetid 169=POS All allowed ([auth].[PermissionSet]), Third const parameter PermissionId 19 = Approving ([auth].[Permission])
													   ( 169,@securableTypeID,20,@globalReconciliationSecurableId)    -- first const parameter PermisionSetid 169=POS All allowed ([auth].[PermissionSet]), Third const parameter PermissionId 20 = Granted ([auth].[Permission])
END

IF NOT EXISTS (SELECT 1 FROM dbo.ApplicationFunction WHERE [Id] = @globalReconciliationSecurableId)
BEGIN
	INSERT INTO [dbo].[ApplicationFunction] VALUES ( @globalReconciliationSecurableId,N'Global Reconciliation',N'Button Global Reconciliation',@securableTypeID, '[20]') -- last parameter equal to added permissions 20 = Granted
END
ELSE
BEGIN
	UPDATE [dbo].[ApplicationFunction]
	SET [Name] = N'Global Reconciliation'
		,[Description] = N'Button Global Reconciliation'
		,[SecurableTypeId] = @securableTypeID
		,[permissionFilter] = '[20]'
	WHERE Id = @globalReconciliationSecurableId
END

-- End Global Reconciliation Permissions
