<!DOCTYPE html>
<html lang='en'>
    <head>
        <title>spa</title>
        <link rel="stylesheet" href="static/main.css">

        <script>
          function postInput(section, dict) {
              const data = dict
              console.log('data json: ', JSON.stringify(data))
              const options = {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body : JSON.stringify(data)
                  };

            fetch(`/${section}`, options)
                .then(response=>response.text())
                .then(text=>{
                console.log('text: ', text)
                console.log('options: ', options)
                let t = text;
                document.querySelector('#success').innerHTML = t
                     })
                }

            function showSection(section) {
                fetch(`/${section}`)
                .then(response=>response.text())
                .then(text=>{            
                    console.log(text)
                    if (section=='page3') {
                        sample = JSON.parse(text);
                        t=''
                        for(let i in sample) {
                            t+=sample[i]+'<br>';
                            }
                    document.querySelector('#p').innerHTML = t;
                                }
                    else if(section=='page2'){
                       console.log('two')
                       document.querySelector('#uq').innerHTML = text;     
                          }
                    else if(section=='page1')
                      {console.log('diffrent story')}
                })
            }
                    
            function showPage(page) {
                document.querySelectorAll('.spa').forEach(d => {
                d.style.display = 'none';
            });
                document.querySelector(`#${page}`).style.display = 'block';
            }

            document.addEventListener('DOMContentLoaded', function() {
                document.querySelectorAll('.click').forEach(button => {
                button.onclick = function() {
                if(this.dataset.page === 'page4') {
                    console.log('klniete i porównane', this.dataset.page)
                    text = document.getElementById('usa').value
                    var dict = { 'userAnswer': text };
                    postInput(this.dataset.page, dict)
                            }
                else if(this.dataset.page === 'page5') {
                   var question = document.getElementById('q').value;  
                   var answer = document.getElementById('a').value;
                   console.log('question and answer: ', question, answer);
                   var dictQA = {'question': question, 'answer': answer}
                   postInput(this.dataset.page, dictQA);
                            }
                else {
                    showSection(this.dataset.page);                
                    showPage(this.dataset.page);
                         }
                    }
                })
           });
            
        </script>
    </head>
        <body>
            <button class='click' data-page='page1'>p1</button>
            <button class='click' data-page='page2'>p2</button>
            <button class='click' data-page='page3'>p3</button>
            <div class='spa' id='page1'>
                    <label for="q">Pytanie:</label><br>
                    <input id='q' type="text" name='question' value="A"><br>
                    <label for="a">Odpowiedź:</label><br>
                    <input id='a' type="text" name='answer' value="Bcccc"><br><br>
                    <button class='click' data-page='page5' type="submit">Wyśli</button>
            </div>
            <div class='spa' id='page2'>
                    <h1 id="uq">uq</h1>
                    <label>question</label>
                    <input id='usa' type="text" name="userQuestion"><br>
                    <button class = 'click' data-page = 'page4'>submit</button>
            </div>
            <div class='spa' id='page3'>
                <h1>Lista pytań</h1>
                <dl id='p'></dl>
            </div>
            <h4 id='success'>Result: {{success}}</h4>
            <h3 id='q'></h3>
            <div class='spa' id='page4'><h3>page 4</h3></div>
        </body>
