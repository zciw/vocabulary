<!DOCTYPE html>
<html lang='en'>
    <head>
        <title>spa</title>
        <link rel="stylesheet" href="static/main.css">

        <script>
          function postInput(section, input) {
              console.log('funkcja odpaliła')
              const data = {'userAnswer' : input};
              console.log(JSON.stringify(data))
              const options = {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body : JSON.stringify(data)
                  };

            fetch(`/${section}`, options)
                .then(response=>response.text())
                .then(text=>{
                console.log('text: ', text)
                console.log('options: ', options)
                if(section=='q'){
                    let t = text;
                    document.querySelector('#q').innerHTML = t
            }
        })
                }

            function showSection(section) {
                fetch(`/${section}`)
                .then(response=>response.text())
                .then(text=>{            
                    console.log(text)
                    if (section=='page3') {
                        sample = JSON.parse(text);
                        t=''
                        for(let i in sample) {
                            t+=sample[i]+'<br>';
                            }
                    document.querySelector('#p').innerHTML = t;
                                }
                    else if(section=='page2'){
                       console.log('two')
                       document.querySelector('#uq').innerHTML = text;     
                          }
                    else if(section=='page1')
                      {console.log('diffrent story')}
                })
            }
                    
            function showPage(page) {
                document.querySelectorAll('.spa').forEach(d => {
                d.style.display = 'none';
            });
                document.querySelector(`#${page}`).style.display = 'block';
            }

            document.addEventListener('DOMContentLoaded', function() {
                document.querySelectorAll('.click').forEach(button => {
                button.onclick = function() {
                if(this.dataset.page === 'page4') {
                    console.log('czy to page4: ', this.dataset.page)
                    text = document.getElementById('usa').value
                    console.log('text ', text)
                    postInput(this.dataset.page, text)
                            }
                else {
                    showSection(this.dataset.page);                
                    showPage(this.dataset.page);
                         }
                    }
                })
           });
            
        </script>
    </head>
        <body>
            <button class='click' data-page='page1'>p1</button>
            <button class='click' data-page='page2'>p2</button>
            <button class='click' data-page='page3'>p3</button>
            <div class='spa' id='page1'>
                <form action="" method="POST">
                    <label for="q">Pytanie:</label><br>
                    <input type="text" name='question' value="A"><br>
                    <label for="a">Odpowiedź:</label><br>
                    <input type="text" name='answer' value="Bcccc"><br><br>
                    <input type="submit" value="Potwierdź">
                </form>
            </div>
            <div class='spa' id='page2'>
                    <h1 id="uq">uq</h1>
                    <label>question</label>
                    <input id='usa' type="text" name="userQuestion"><br>
                    <button class = 'click' data-page = 'page4'>submit</button>
            </div>
            <div class='spa' id='page3'>
                <h1>Lista pytań</h1>
                <dl id='p'></dl>
            </div>
            <div id='success'><h4>Result: {{success}}</h4></div>
            <h3 id='q'></h3>
            <div class='spa' id='page4'><h3>page 4</h3></div>

        </body>
